
@{
    ViewBag.Title = "View1";
    Layout = "~/Views/Shared/MainLayout.cshtml";
}
<div class="search">
    <input class="w3-input w3-border w3-margin-bottom searchinput" id="case-name" name="Search" type="text" placeholder="Casename Here!" required>

    <input class="w3-input w3-border w3-margin-bottom searchinput" id="search-from" name="Search" type="text" placeholder="Date From! Type:2018-08-13" required>

    <input class="w3-input w3-border w3-margin-bottom searchinput" id="search-to" name="Search" type="text" placeholder="Date To! Type:2018-08-15" required>

    <button onclick="Search()" class="btn btn-info" style="display:inline; margin-left: 10px;">Search</button>
</div>

<div class="limiter">
    <div class="container-table100" id="content1">
        <div class="wrap-table100">
            <table id="tab_customers" class="table">
                <thead>
                    <tr class='row header'>
                        <th class="cell">No</th>
                        <th class="cell">First Name</th>
                        <th class="cell">Middle Name</th>
                        <th class="cell">Last Name</th>
                        <th class="cell">Nationality</th>
                        <th class="cell">Case Name</th>
                        <th class="cell">Case Text</th>
                        <th class="cell">Create User ID</th>
                    </tr>
                </thead>
                <tbody class="table-body"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="id02" class="modal1">

    <!-- Modal content -->
    <div class="modal-content1">
        <span class="close" onclick="document.getElementById('id02').style.display='none'">&times;</span>
        <div class="limiter1">
            
        </div>

        <div class="footer" style="margin-top: 10px; display:flex;">
            <button class="btn btn-primary" onclick="document.getElementById('id02').style.display = 'none'">Ok</button>
        </div>
    </div>
</div>
@section Styles{
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <style>
        .modal1 {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content1 {
            background-color: #fefefe;
            margin: auto;
            padding: 10px;
            border: 1px solid #888;
            font-size: 13px;
            word-break: break-all;
            float: left;
            width: 100%;
        }

        .modal-content2 {
            background-color: #fefefe;
            margin: auto;
            padding: 10px;
            border: 1px solid #888;
            width: 1500px;
            min-width: 1000px;
            max-width: 1600px;
            font-size: 14px;
            word-break: break-all;
        }

        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        * {
            margin: 0;
            padding: 0;
        }

        .tree ul {
            padding-top: 20px;
            position: relative;
            transition: all 0.5s;
            -webkit-transition: all 0.5s;
            -moz-transition: all 0.5s;
        }

        .tree li {
            float: left;
            text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 5px 0 5px;
            transition: all 0.5s;
            -webkit-transition: all 0.5s;
            -moz-transition: all 0.5s;
        }

            /*We will use ::before and ::after to draw the connectors*/

        .tree li::before, .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 50%;
            border-top: 1px solid #ccc;
            width: 50%;
            height: 20px;
        }

        .tree li::after {
            right: auto;
            left: 50%;
            border-left: 1px solid #ccc;
        }

            /*We need to remove left-right connectors from elements without 
any siblings*/
            .tree li:only-child::after, .tree li:only-child::before {
                display: none;
            }

            /*Remove space from the top of single children*/
            .tree li:only-child {
                padding-top: 0;
            }

            /*Remove left connector from first child and 
right connector from last child*/
            .tree li:first-child::before, .tree li:last-child::after {
                border: 0 none;
            }
            /*Adding back the vertical connector to the last nodes*/
            .tree li:last-child::before {
                border-right: 1px solid #ccc;
                border-radius: 0 5px 0 0;
                -webkit-border-radius: 0 5px 0 0;
                -moz-border-radius: 0 5px 0 0;
            }

            .tree li:first-child::after {
                border-radius: 5px 0 0 0;
                -webkit-border-radius: 5px 0 0 0;
                -moz-border-radius: 5px 0 0 0;
            }

        /*Time to add downward connectors from parents*/
        .tree ul ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            border-left: 1px solid #ccc;
            width: 0;
            height: 20px;
        }

        .tree li a {
            /*border: 1px solid #ccc;*/
            padding: 5px 10px;
            text-decoration: none;
            color: #666;
            font-family: arial, verdana, tahoma;
            font-size: 12px;
            display: inline-block;
            border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            transition: all 0.5s;
            -webkit-transition: all 0.5s;
            -moz-transition: all 0.5s;
        }
        p {
            color: #666;
        }
            p.different {
                font-size: 14px;
                color: cornflowerblue;
            }

            /*Time for some hover effects*/
            /*We will apply the hover effect the the lineage of the element also*/
        .tree li a:hover, .tree li a:hover + ul li a {
            background: #c8e4f8;
            color: #000;
            /*border: 1px solid #94a0b4;*/
        }
            /*Connector styles on hover*/
        .tree li a:hover + ul li::after,
        .tree li a:hover + ul li::before,
        .tree li a:hover + ul::before,
        .tree li a:hover + ul ul::before {
            border-color: #94a0b4;
        }
    </style>
}
@section scripts{

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script>
        var all_data;
        var search_case_name = "";
        var search_date_from = "", search_date_to = "";
        $(document).ready(function () {
            $(".class1").removeClass("active");
            $("#relationship").addClass("active");
            
        });
        function display(){
            $.ajax({
                type: "post", url: 'http://localhost:2231/Main/GetDataForRelationship', success: function (result) {
                    $('.table-body').html("");
                    var i = 1;
                    all_data = result;
                    if ((search_case_name == "") && ($("#search-from").val() == "") && ($("#search-to").val() == "")) {
                        result.forEach(function (element) {
                            $('.table-body').html($('.table-body').html() + '<tr class="row rowbody" id=' + element.ID + '><th class="cell">' + (i++) + '</th><th class="cell">' + element.Firstname + '</th><th class="cell">' + element.Middlename + '</th><th class="cell">' + element.Lastname + '</th><th class="cell">' + element.Nationality + '</th><th class="cell">' + element.Case_name + '</th><th class="cell">' + element.Case_text + '</th><th class="cell">' + element.Username + '</th></tr>');
                        });
                    }
                    else if ((search_case_name != "") && ((($("#search-from").val() == "") && ($("#search-to").val() == "")))) {
                        result.forEach(function (element) {
                            if (String(element.Case_name).indexOf(String(search_case_name)) != -1 || String(element.Firstname).indexOf(String(search_case_name)) != -1 || String(element.Middlename).indexOf(String(search_case_name)) != -1 || String(element.Group_name).indexOf(String(search_case_name)) != -1 || String(element.Group_country).indexOf(String(search_case_name)) != -1 || String(element.Case_text).indexOf(String(search_case_name)) != -1 || String(element.ID_type).indexOf(String(search_case_name)) != -1 || String(element.B_Account_number).indexOf(String(search_case_name)) != -1 || String(element.B_Account_country).indexOf(String(search_case_name)) != -1 || String(element.B_Account_type).indexOf(String(search_case_name)) != -1 || String(element.E_Account_name).indexOf(String(search_case_name)) != -1 || String(element.E_Account_typename).indexOf(String(search_case_name)) != -1 || String(element.IPs_ip).indexOf(String(search_case_name)) != -1 || String(element.IPs_country).indexOf(String(search_case_name)) != -1 || String(element.Skill_name).indexOf(String(search_case_name)) != -1 || String(element.Skill_text).indexOf(String(search_case_name)) != -1 || String(element.Nationality).indexOf(String(search_case_name)) != -1 || String(element.Skill_type).indexOf(String(search_case_name)) != -1) {
                                $('.table-body').html($('.table-body').html() + '<tr class="row rowbody" id=' + element.ID + '><th class="cell">' + (i++) + '</th><th class="cell">' + element.Firstname + '</th><th class="cell">' + element.Middlename + '</th><th class="cell">' + element.Lastname + '</th><th class="cell">' + element.Nationality + '</th><th class="cell">' + element.Case_name + '</th><th class="cell">' + element.Case_text + '</th><th class="cell">' + element.Username + '</th></tr>');
                            }
                        });
                    }

                    else {

                        result.forEach(function (element) {
                            if (String(element.Case_name).indexOf(String(search_case_name)) != -1 || String(element.Firstname).indexOf(String(search_case_name)) != -1 || String(element.Middlename).indexOf(String(search_case_name)) != -1 || String(element.Group_name).indexOf(String(search_case_name)) != -1 || String(element.Group_country).indexOf(String(search_case_name)) != -1 || String(element.Case_text).indexOf(String(search_case_name)) != -1 || String(element.ID_type).indexOf(String(search_case_name)) != -1 || String(element.B_Account_number).indexOf(String(search_case_name)) != -1 || String(element.B_Account_country).indexOf(String(search_case_name)) != -1 || String(element.B_Account_type).indexOf(String(search_case_name)) != -1 || String(element.E_Account_name).indexOf(String(search_case_name)) != -1 || String(element.E_Account_typename).indexOf(String(search_case_name)) != -1 || String(element.IPs_ip).indexOf(String(search_case_name)) != -1 || String(element.IPs_country).indexOf(String(search_case_name)) != -1 || String(element.Skill_name).indexOf(String(search_case_name)) != -1 || String(element.Skill_text).indexOf(String(search_case_name)) != -1 || String(element.Nationality).indexOf(String(search_case_name)) != -1 || String(element.Skill_type).indexOf(String(search_case_name)) != -1) {
                                if (compare_date($("#search-from").val(), element.ModifyTime) == 0 && compare_date(element.ModifyTime, $("#search-to").val()) == 0) {
                                    $('.table-body').html($('.table-body').html() + '<tr class="row rowbody" id=' + element.ID + '><th class="cell">' + (i++) + '</th><th class="cell">' + element.Firstname + '</th><th class="cell">' + element.Middlename + '</th><th class="cell">' + element.Lastname + '</th><th class="cell">' + element.Nationality + '</th><th class="cell">' + element.Case_name + '</th><th class="cell">' + element.Case_text + '</th><th class="cell">' + element.Username + '</th></tr>');
                                }
                            }
                        });
                    }

                    var imgData = $('tbody>tr');
                    if (imgData.length == 0) {
                        alert("no result");
                        return;
                    }

                    $(".rowbody").click(function () {
                        var arr = [];
                        currentid = $(this).attr("id");                        
                        
                        all_data.forEach(function (element) {
                            if (element.ID == currentid) {
                                arr[0] = element.Firstname;
                                arr[1] = element.Middlename;
                                arr[2] = element.Lastname;
                                arr[3] = element.Nationality;
                                arr[4] = element.Group_name;
                                arr[5] = element.Group_country;
                                arr[6] = element.Case_name;
                                arr[7] = element.Case_text;
                                arr[8] = element.B_Account_number;
                                arr[9] = element.B_Account_country;
                                arr[10] = element.B_Account_type;
                                arr[11] = element.E_Account_name;
                                arr[12] = element.E_Account_typename;
                                arr[13] = element.IPs_ip;
                                arr[14] = element.IPs_country;
                                arr[15] = element.Skill_name;
                                arr[16] = element.Skill_text;
                                arr[17] = element.Skill_type;
                            }
                        });
                        var str = '<div class="tree"><ul><li><a href="#"><i class="fas fa-user fa-5x" style="display:block;"></i><b class="medium_p">' + arr[6] + '</b></a>';
                        str += '<ul class="children">';
                        var flag = 0;
                        all_data.forEach(function (element) {
                            //Nationality = dr["Nationality"].ToString()
                            // console.log(currentid);
                            if (element.ID != currentid) {
                                
                                if (arr[0] == element.Firstname) {
                                    str += '<li class="identifier"><a href="#">';
                                    str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                    str += '<div class="match" id="' + element.ID  + '" style="display:none;">';
                                    flag = 1;
                                    if (element.Firstname != "") {
                                        str += '<b class="medium_p style="display:block;"">Firstname:' + element.Firstname + '</b>';
                                    }
                                    
                                }
                                if (arr[1] == element.Middlename) {                           
                                    if (element.Middlename != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Middlename:' + element.Middlename + '</b>';
                                    }
                                    
                                }
                                if (arr[2] == element.Lastname) {
                                    if (element.Lastname != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Lastname:' + element.Lastname + '</b>';
                                    }
                                    
                                }
                                if (arr[3] == element.Nationality) {
                                    if (element.Nationality != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Nationality:' + element.Nationality + '</b>';
                                    }
                                    
                                }
                                if (arr[4] === element.Group_name) {
                                    if (element.Group_name != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Group_name:' + element.Group_name + '</b>';
                                    }
                                        
                                }
                                if (arr[5] == element.Group_country) {
                                    if (element.Group_country != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Group_country:' + element.Group_country + '</b>';
                                    }
                                    
                                }
                                if (arr[7] == element.Case_text) {
                                    if (element.Case_text != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        console.log("here");
                                        str += '<b class="medium_p" style="display:block;">Case_text:' + element.Case_text + '</b>';
                                    }
                                    
                                }
                                if (arr[8] == element.B_Account_number) {
                                    if (element.B_Account_number != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">B_Account_number:' + element.B_Account_number + '</b>';
                                    }
                                    
                                }
                                if (arr[9] == element.B_Account_country) {
                                    if (element.B_Account_country != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">B_Account_country:' + element.B_Account_country + '</b>';
                                    }
                                    
                                }
                                if (arr[10] == element.B_Account_type) {
                                    if (element.B_Account_type != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">B_Account_type:' + element.B_Account_type + '</b>';
                                    }
                                    
                                }
                                if (arr[11] == element.E_Account_name) {
                                    if (element.E_Account_name != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">E_Account_name:' + element.E_Account_name + '</b>';
                                    }
                                    
                                }
                                if (arr[12] == element.E_Account_typename) {
                                    if (element.E_Account_typename != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">E_Account_typename:' + element.E_Account_typename + '</b>';
                                    }
                                    
                                }
                                if (arr[13] == element.IPs_ip) {
                                    if (element.IPs_ip != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">IPs_ip:' + element.IPs_ip + '</b>';
                                    }
                                    
                                }
                                if (arr[14] == element.IPs_country) {
                                    if (element.IPs_country != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">IPs_country:' + element.IPs_country + '</b>';
                                    }
                                    
                                }
                                if (arr[15] == element.Skill_name) {
                                    if (element.Skill_name != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Skill_name:' + element.Skill_name + '</b>';
                                    }
                                    
                                }
                                if (arr[16] == element.Skill_text) {
                                    if (element.Skill_text != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Skill_text:' + element.Skill_text + '</b>';
                                    }
                                    
                                }
                                if (arr[17] == element.Skill_type) {
                                    if (element.Skill_type != "") {
                                        if (flag == 0) {
                                            str += '<li class="identifier"><a href="#">';
                                            str += '<i class="far fa-user fa-5x" style="display:block;"></i><b>' + element.Case_name + '</b>';
                                            str += '<div class="match" id="' + element.ID + '" style="display:none;">';
                                            flag = 1;
                                        }
                                        str += '<b class="medium_p" style="display:block;">Skill_type:' + element.Skill_type + '</b>';
                                    }
                                    
                                }
                                if (flag == 1) {
                                    str += "</div>";
                                }
                                str += '</a></li>';
                                flag = 0;
                            }
                        });
                        str += '</ul>';
                        str += '</li></ul></div>';
                        $('.limiter1').html('');
                        $('.limiter1').html(str);

                        $(".identifier").mouseover(function () {
                            console.log("came here");
                            $(this).children().children('div').css("display", "block");
                        });
                        $(".identifier").mouseout(function () {
                            $(this).children().children('div').css("display", "none");
                        });

                        var xx = $('.children li');

                        console.log(xx);
                        if (xx.length != 0) {
                            $("#id02").css("display", "block");
                            
                        }
                        else {
                            alert("this case has no relationship with any case");
                        }


                    });

                }
            });
        }
        function Search() {
            $('.table-body').html("");
            search_case_name = $("#case-name").val();
            search_date_from = $("#search-from").val();
            search_date_to = $("#search-to").val();
            if (search_case_name == "" && search_date_from == "" && search_date_to == "") {
                //alert("You must input something!")
                return;
            }

            if ((search_case_name == "") && ($("#search-from").val() == "") && ($("#search-to").val() == "")) {
                display();
                return;
            }
            else if ((search_case_name == "") || (($("#search-from").val() == "") && ($("#search-to").val() == ""))) {
                display();
                return;
            }
            else if (compare_date(search_date_from, search_date_to) == 3) {
                return;
            }
            else if ((search_case_name != "") || (search_date_from != "" && search_date_to != "")) {
                display();
            }
        }

        function compare_date(val1, val2) {
            var d1 = new Date(val1);
            var d2 = new Date(val2);
            //console.log(val1, ",", val2);
            //console.log(d1, ",", d2);
            if (d1 <= d2) {
                return 0;
            }
            else if (d1 >= d2) {
                return 1;
            }
            else if (d1 == d2) {

                return 2;
            }
            else {
                return 3;
            }
        }  
    </script>    
}



