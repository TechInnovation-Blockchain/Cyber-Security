@{
    ViewBag.Title = "Edit Case";
    Layout = "~/Views/Shared/MainLayout.cshtml";
}

<div class="search">
    <input class="w3-input w3-border w3-margin-bottom searchinput" id="case-name" name="Search" type="text" placeholder="Casename Here!" required>

    <input class="w3-input w3-border w3-margin-bottom searchinput" id="search-from" name="Search" type="text" placeholder="Date From! Type:2018-08-13" required>

    <input class="w3-input w3-border w3-margin-bottom searchinput" id="search-to" name="Search" type="text" placeholder="Date To! Type:2018-08-15" required>

    <button onclick="Search()" class="btn btn-info" style="display:inline; margin-left: 10px;">Search</button>
</div>

<div class="limiter">
    <div class="container-table100" id="content1">
        <div class="wrap-table100">
            <table id="tab_customers" class="table">
                <thead>
                    <tr class='row header'>
                        <th class="cell">No</th>
                        <th class="cell">First Name</th>
                        <th class="cell">Middle Name</th>
                        <th class="cell">Last Name</th>
                        <th class="cell">Nationality</th>
                        <th class="cell">Case Name</th>
                        <th class="cell">Case Text</th>
                        <th class="cell">Create User ID</th>
                    </tr>
                </thead>
                <tbody class="table-body"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="id01" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
        <header class="w3-container w3-teal" style="background: url('http://localhost:2231/images/header.jpg') no-repeat center center; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover; ">
            <span onclick="document.getElementById('id01').style.display='none'"
                  class="w3-button w3-display-topright">&times;</span>
            <h2>You can Edit your Case here!</h2>
        </header>
        <div class="w3-container modal-background">
            <div class="w3-section">
                <label><b class="big_p">Basic Info</b></label>
                <hr />
                <label><b class="medium_p">Firstname</b></label>
                <input class="firstname w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Middlename</b></label>
                <input class="middlename w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Lastname</b></label>
                <input class="lastname w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b>Nationality</b></label>
                <input class="nationality w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">Group Info</b></label>
                <hr />
                <label><b class="medium_p">Name</b></label>
                <input class="groupname w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Country</b></label>
                <input class="groupcountry w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">Case Info</b></label>
                <hr />
                <label><b class="medium_p">Name</b></label>
                <input class="casename w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Text</b></label>
                <input class="casetext w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">B_Account Info</b></label>
                <hr />
                <label><b class="medium_p">Number</b></label>
                <input class="baccountnumber w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Country</b></label>
                <input class="baccountcountry w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">AccountType</b></label>
                <input class="baccounttype w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">E_Account Info</b></label>
                <hr />
                <label><b class="medium_p">Name</b></label>
                <input class="eaccountname w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Typename</b></label>
                <input class="eaccounttypename w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">IP Info</b></label>
                <hr />
                <label><b class="medium_p">IP</b></label>
                <input class="ip w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Country</b></label>
                <input class="ipcountry w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">Skill Info</b></label>
                <hr />
                <label><b class="medium_p">Name</b></label>
                <input class="skillname w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Text</b></label>
                <input class="skilltext w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <label><b class="medium_p">Type</b></label>
                <input class="skilltype w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label><b class="big_p">Extra Info</b></label>
                <hr />
                <label><b class="medium_p">ID_Type</b></label>
                <input class="idtype w3-input w3-border w3-margin-bottom w3-round-large" type="text" required>
                <br />
                <label class="createuser"></label>
                <br />
                <label class="lastmodifytime"></label>
                <br />
                <br />

                <div style="margin-top: 10px;">
                    <button id="btn_upgrade" class="btn btn-success" onclick="javascript:Update()" style="display:inline;">Update</button>
                    <button id="btn_remove" class="btn btn-success" onclick="javascript:Remove()" style="display:inline;">Remove</button>
                    <button id="btn_cancel" class="btn btn-primary" onclick="Cancel()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts{

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script>
        var currentid;
        var all_data;
        var search_case_name = "";
        var search_date_from = "", search_date_to = "";
        $(document).ready(function () {
            if (localStorage.getItem("permission") != "admin") {
                alert("You have no permission to access this page!");
                window.location.href = 'http://localhost:2231/Main/index';
            }
            //display();
            $(".class1").removeClass("active");
            $("#editcase").addClass("active");


        });


        function display() {
            $.ajax({
                type: "post", url: 'http://localhost:2231/Main/GetDataForCase', success: function (result) {
                    $('.table-body').html("");
                    var i = 1;
                    all_data = result;
                    if ((search_case_name == "") && ($("#search-from").val() == "") && ($("#search-to").val() == "")) {
                        result.forEach(function (element) {
                            $('.table-body').html($('.table-body').html() + '<tr class="row rowbody" id=' + element.ID + '><th class="cell">' + (i++) + '</th><th class="cell">' + element.Firstname + '</th><th class="cell">' + element.Middlename + '</th><th class="cell">' + element.Lastname + '</th><th class="cell">' + element.Nationality + '</th><th class="cell">' + element.Case_name + '</th><th class="cell">' + element.Case_text + '</th><th class="cell">' + element.Username + '</th></tr>');
                        });
                    }
                    else if ((search_case_name != "") && ((($("#search-from").val() == "") && ($("#search-to").val() == "")))) {
                        result.forEach(function (element) {
                            if (String(element.Case_name).indexOf(String(search_case_name)) != -1 || String(element.Firstname).indexOf(String(search_case_name)) != -1 || String(element.Middlename).indexOf(String(search_case_name)) != -1 || String(element.Group_name).indexOf(String(search_case_name)) != -1 || String(element.Group_country).indexOf(String(search_case_name)) != -1 || String(element.Case_text).indexOf(String(search_case_name)) != -1 || String(element.ID_type).indexOf(String(search_case_name)) != -1 || String(element.B_Account_number).indexOf(String(search_case_name)) != -1 || String(element.B_Account_country).indexOf(String(search_case_name)) != -1 || String(element.B_Account_type).indexOf(String(search_case_name)) != -1 || String(element.E_Account_name).indexOf(String(search_case_name)) != -1 || String(element.E_Account_typename).indexOf(String(search_case_name)) != -1 || String(element.IPs_ip).indexOf(String(search_case_name)) != -1 || String(element.IPs_country).indexOf(String(search_case_name)) != -1 || String(element.Skill_name).indexOf(String(search_case_name)) != -1 || String(element.Skill_text).indexOf(String(search_case_name)) != -1 || String(element.Nationality).indexOf(String(search_case_name)) != -1 || String(element.Skill_type).indexOf(String(search_case_name)) != -1) {
                                $('.table-body').html($('.table-body').html() + '<tr class="row rowbody" id=' + element.ID + '><th class="cell">' + (i++) + '</th><th class="cell">' + element.Firstname + '</th><th class="cell">' + element.Middlename + '</th><th class="cell">' + element.Lastname + '</th><th class="cell">' + element.Nationality + '</th><th class="cell">' + element.Case_name + '</th><th class="cell">' + element.Case_text + '</th><th class="cell">' + element.Username + '</th></tr>');
                            }
                        });
                    }

                    else {

                        result.forEach(function (element) {
                            if (String(element.Case_name).indexOf(String(search_case_name)) != -1 || String(element.Firstname).indexOf(String(search_case_name)) != -1 || String(element.Middlename).indexOf(String(search_case_name)) != -1 || String(element.Group_name).indexOf(String(search_case_name)) != -1 || String(element.Group_country).indexOf(String(search_case_name)) != -1 || String(element.Case_text).indexOf(String(search_case_name)) != -1 || String(element.ID_type).indexOf(String(search_case_name)) != -1 || String(element.B_Account_number).indexOf(String(search_case_name)) != -1 || String(element.B_Account_country).indexOf(String(search_case_name)) != -1 || String(element.B_Account_type).indexOf(String(search_case_name)) != -1 || String(element.E_Account_name).indexOf(String(search_case_name)) != -1 || String(element.E_Account_typename).indexOf(String(search_case_name)) != -1 || String(element.IPs_ip).indexOf(String(search_case_name)) != -1 || String(element.IPs_country).indexOf(String(search_case_name)) != -1 || String(element.Skill_name).indexOf(String(search_case_name)) != -1 || String(element.Skill_text).indexOf(String(search_case_name)) != -1 || String(element.Nationality).indexOf(String(search_case_name)) != -1 || String(element.Skill_type).indexOf(String(search_case_name)) != -1) {
                                if (compare_date($("#search-from").val(), element.ModifyTime) == 0 && compare_date(element.ModifyTime, $("#search-to").val()) == 0) {
                                    $('.table-body').html($('.table-body').html() + '<tr class="row rowbody" id=' + element.ID + '><th class="cell">' + (i++) + '</th><th class="cell">' + element.Firstname + '</th><th class="cell">' + element.Middlename + '</th><th class="cell">' + element.Lastname + '</th><th class="cell">' + element.Nationality + '</th><th class="cell">' + element.Case_name + '</th><th class="cell">' + element.Case_text + '</th><th class="cell">' + element.Username + '</th></tr>');
                                }
                            }
                        });
                    }

                    var imgData = $('tbody>tr');
                    if (imgData.length == 0) {
                        alert("no result");
                        return;
                    }


                    $(".rowbody").click(function () {
                        currentid = $(this).attr("id");
                        $("#id01").css("display", "block");
                        all_data.forEach(function (element) {
                            //Nationality = dr["Nationality"].ToString()
                           // console.log(currentid);
                            if (element.ID == currentid) {
                                $(".firstname").val(element.Firstname);
                                $(".middlename").val(element.Middlename);
                                $(".lastname").val(element.Lastname);
                                $(".nationality").val(element.Nationality);

                                $(".groupname").val(element.Group_name);
                                $(".groupcountry").val(element.Group_country);

                                $(".casename").val(element.Case_name);
                                $(".casetext").val(element.Case_text);

                                $(".baccountnumber").val(element.B_Account_number);
                                $(".baccountcountry").val(element.B_Account_country);
                                $(".baccounttype").val(element.B_Account_type);

                                $(".eaccountname").val(element.E_Account_name);
                                $(".eaccounttypename").val(element.E_Account_typename);

                                $(".ip").val(element.IPs_ip);
                                $(".ipcountry").val(element.IPs_country);

                                $(".skillname").val(element.Skill_name);
                                $(".skilltext").val(element.Skill_text);
                                $(".skilltype").val(element.Skill_type);

                                $(".idtype").val(element.ID_type);

                                str = "<b class='big_p'>Creat User : <b class='medium_p'>" + element.Username + "</b></b>";
                                $(".createuser").html(str);

                                str = "<b class='big_p'>Last ModifiedTime : <b class='medium_p'>" + element.ModifyTime + "</b></b>";
                                $(".lastmodifytime").html(str);
                            }
                        });
                    });

                }
            });
        }

        function AddnewModal() {
            $("#id01").css("display", "block");

        }
        
        function Update() {
            console.log("Came");
                var today = new Date();
                var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
                var parse_data = ['update', $(".firstname").val(), $(".middlename").val(), $(".lastname").val(), $(".nationality").val(), $(".groupname").val(), $(".groupcountry").val(), $(".casename").val(), $(".casetext").val(), $(".baccountnumber").val(), $(".baccountcountry").val(), $(".baccounttype").val(), $(".eaccountname").val(), $(".eaccounttypename").val(), $(".ip").val(), $(".ipcountry").val(), $(".skillname").val(), $(".skilltext").val(), $(".skilltype").val(), $(".createuser").val(), $(".idtype").val(), currentid, date, localStorage.getItem("username")];
                $.ajax({
                    type: "post", url: 'http://localhost:2231/Main/AddCase',
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(parse_data), success: function (result) {
                        console.log(result);

                    }
                });
                $('#id01').css('display', 'none');
                window.localStorage.href = "http://localhost:2231/Main/EditCase";
            
        }
        
        function Remove() {
                var parse_data = ['remove', currentid];
                $.ajax({
                    type: "post", url: 'http://localhost:2231/Main/AddCase',
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(parse_data), success: function (result) {
                    }
                });
                $('#id01').css('display', 'none');
                window.localStorage.href = "http://localhost:2231/Main/EditCase";
            
            
        }

        function Cancel() {
            $('#id01').css('display', 'none');
            display();
        }

        function Search() {
            $('.table-body').html("");
            search_case_name = $("#case-name").val();
            search_date_from = $("#search-from").val();
            search_date_to = $("#search-to").val();

            if (search_case_name == "" && search_date_from == "" && search_date_to == "") {
                //alert("You must input something!")
                return;
            }

            if ((search_case_name == "") && ($("#search-from").val() == "") && ($("#search-to").val() == "")) {
                display();
                return;
            }
            else if ((search_case_name == "") || (($("#search-from").val() == "") && ($("#search-to").val() == ""))) {
                display();
                return;
            }
            else if (compare_date(search_date_from, search_date_to) == 3) {
                return;
            }
            else if ((search_case_name != "") || (search_date_from != "" && search_date_to != "")) {
                display();
            }
        }

        function compare_date(val1, val2) {
            var d1 = new Date(val1);
            var d2 = new Date(val2);
            //console.log(val1, ",", val2);
            //console.log(d1, ",", d2);
            if (d1 <= d2) {
                return 0;
            }
            else if (d1 >= d2) {
                return 1;
            }
            else if (d1 == d2) {

                return 2;
            }
            else {
                return 3;
            }
        }
    </script>
}